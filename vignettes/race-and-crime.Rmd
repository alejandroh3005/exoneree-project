---
title: Race and Crime
author: Alejandro D. Hernandez
date: August 2024
output:
  pdf_document: default
subtitle: Analysis of the U.S. National Registry of Exonerations
---

```{r setup, include=FALSE}
### -----------------------------------------------------------
### Setup
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(root.dir = paste(head(unlist(strsplit(getwd(), "/")), -1),
                                      collapse = "/"))
options(knitr.kable.NA = '-')
labs = knitr::all_labels()
labs = labs[!labs %in% c("setup", "llm_appendix", "allcode")]

library(tidyverse)
library(gridExtra)
library(gtsummary)
library(gt)
library(knitr)
```

# Background

The pursuit of justice is a fundamental pillar of the United States legal system, aiming to hold accountability for the guilty and protection of the innocent. However, the justice system design induces wrongful convictions through eyewitness misidentification, false or misleading forensic evidence, perjury, official misconduct, and inadequate legal defense. The consequences of wrongful conviction are serious and often irreversible, resulting in loss of liberty and damage to the reputation of individuals and their families. Increased scrutiny of criminal cases and efforts of dedicated legal advocates have facilitated the *exoneration* (reversal of conviction and clearing of charges) of numerous individuals who were unjustly convicted. Exoneration brings attention to shortcomings of the criminal justice system and consideration of innocents who are currently imprisoned.

The National Registry of Exonerations is a project from the University of California, Irvine; University of Michigan; and Michigan State University which gathers detailed information on every exoneration in the United States since 1989. Their extensive registry includes personal demographics and describes criminal sentences, time served, and pathway to exoneration. This wealth of information allows researchers, policymakers, legal practitioners, and the public to analyze trends, identify systemic issues within the criminal justice system, and advocate for reforms aimed at preventing future wrongful convictions.

# Objective

In this study, we examine the National Registry of Exonerations from the University of Michigan to analyze individuals exonerated in the United States between 1989 and 2024 through descriptive statistics and statistical modeling. This document and our work are in progress.

```{r data-loading}
### -----------------------------------------------------------
### Data Loading
rm(list = ls()) # clear workspace
# load data
exonerees <- read.csv("data/exonerees1989-may2024.csv")


# correct Crime Category to be a factor
crime_levels <- c("Violent felony", "Misdemeanor", "Nonviolent felony", 
                  "Misconduct")
exonerees$Crime.Category <- factor(exonerees$Crime.Category, 
                                   levels = crime_levels)

# correct Age Group variables to be factors
age_levels = c("0 - 17", "18 - 29", "30 - 39", "40 - 49", "50 - 64", "65 - 100")
exonerees$Age.Group.at.Crime <- factor(exonerees$Age.Group.at.Crime, 
                                       levels = age_levels)
exonerees$Age.Group.at.Conviction <- factor(exonerees$Age.Group.at.Conviction, 
                                            levels = age_levels)
exonerees$Age.Group.at.Release <- factor(exonerees$Age.Group.at.Release, 
                                         levels = age_levels)
exonerees$Age.Group.at.Exoneration <- factor(exonerees$Age.Group.at.Exoneration,
                                             levels = age_levels)

# correct Race to be a factor
race_levels <- c("Black", "White", "Hispanic", "Asian", "Native American",
                 "Other")
exonerees$Race <- factor(exonerees$Race, levels = race_levels)

# correct Sex to be a factor
exonerees$Sex <- as.factor(exonerees$Sex)

# correct binary tags to also be factors
tag_vars <- c("F.MFE","FC","ILD","P.FA","DNA","MWID","OM","CV","IO","SA","CIU",
              "NC","P","H","JV","CDC","F","JI","M","CSH","SBS","A","FED","PH",
              "BM")
exonerees <- exonerees %>% mutate_at(tag_vars, as.factor)
```

```{r, include=FALSE}
# make sure everything looks good
summary(exonerees)
dim(exonerees)
```

### Which offenses do we examine?

```{r ordered-sample-sizes-table}
### -----------------------------------------------------------
### Ordered Sample Size Tables
# offense frequency (ordered), overall and by race
exonerees %>%
  select(Race, Worst.Crime.Display) %>%
  filter(!is.na(Race)) %>%
  tbl_summary(
    by = Race,
    statistic = list(
      all_categorical() ~ "{n} ({p}%)")) %>%   # count (percent)
  add_overall() %>%
  bold_labels() %>%
  modify_header(label ~ "Offense") %>%
  modify_spanning_header(c(stat_1, stat_2) ~ "Race") %>%
  # convert to a data frame and arrange by a new overall count column
  as.data.frame() %>%
  mutate(overall.count = parse_number(`**Overall**, N = 2,640`)) %>%
  arrange(desc(overall.count)) %>%
  select(-overall.count) %>%  # remove the overall count column
  head() %>%
  kable(caption = "List of high-frequency offenses, by race")
```

Table 1 shows the highest-frequency criminal offenses across groups of race. For example, we read the top-left-most cell as reporting that, among the 2,640 individuals in the National Registry of Exonerations whose alleged crime occurred during or after 1989, 875 or 33% were exonerated from a Murder conviction. Percents are column-wise.

```{r time-served-table}
### -----------------------------------------------------------
### Time Served Table
# set headers to columns, for later use
header_Incarcerated <- paste0("Incarcerated (",
                       formatC(sum(exonerees$Years.Incarcerated), big.mark = ","),
                       " total)")
header_Convicted <- paste0("Convicted (",
                       formatC(sum(exonerees$Years.Convicted), big.mark = ","),
                      " total)")

# time served incarcerated and convicted (ordered), by offense
exonerees %>%
  group_by(Offense = Worst.Crime.Display) %>%
  # summarize total years
  summarise(Incarcerated = sum(Years.Incarcerated),
            Convicted = sum(Years.Convicted)) %>%
  # calculate percents
  mutate(Incarcerated.perc = round(100*Incarcerated / sum(Incarcerated)),
         Convicted.perc = round(100*Convicted / sum(Convicted))) %>%
  # arrange and filter
  arrange(desc(Incarcerated)) %>%
  filter(Incarcerated > 90) %>%
  # reformat count to character
  mutate(Incarcerated = formatC(Incarcerated, big.mark = ","),
         Convicted = formatC(Convicted, big.mark = ",")) %>%
  # combine count and percent
  mutate(Incarcerated = paste0(Incarcerated, " (", Incarcerated.perc, "%)"),
         Convicted = paste0(Convicted, " (", Convicted.perc, "%)")) %>%
  # remove unused columns
  select(-contains(".perc")) %>%
  kable(
    # rename header to include total time across all offenses
    col.names = c("Offense", header_Incarcerated, header_Convicted),
    caption = "Total years spent incarcerated and convicted, by offense")
```

Table 2 shows the criminal offenses that account for the most time spent wrongfully incarcerated/convicted. For example, we read the top-left-most cell as reporting that, among the 17,086 years spent wrongfully incarcerated across all individuals in the National Registry of Exonerations whose alleged crime occurred during or after 1989, 10,979 or 64% were due to a Murder conviction. Again, percents are column-wise.

Table 2 was reproduced for each group of race (see Supplementary), which found that this order of offenses accounting for the most years lost to incarceration or conviction are similar across all subsets of races, especially the largest.

**These tables motivate us to compare the experience of people convicted of these popular and severe offenses between groups of race, so as to measure the extent to which sentence/incarceration is associated with race, within the National Registry of Exonerations.**

# Analysis

### Distribution of years spent incarcerated and convicted, by offense and race

```{r distribution-of-time-spent}
### -----------------------------------------------------------
### Distribution of years spent incarcerated and convicted, by offense and race
## crime, by total time spent incarcerated
plot_times <- function (data, crime_filter = NA) {
  
  # filter the data by crime (optional)
  if (is.na(crime_filter)) {
    crime_filter <- "all" # this is used later for labeling
  } else {
    data <- data %>% filter(Worst.Crime.Display == crime_filter)
  }
  
  ## only include groups of race with 10 or more members present
  # get counts
  counts <- data %>%
    group_by(Race) %>%
    summarise(n = n()) %>%
    filter(n >= 10)
  # filter race groups with too few members
  data <- data %>% filter(Race %in% counts$Race)
  
  # write the subtitle of the plot, which shows counts of race groups
  gg_subtitle <- ""
  included_races <- unique(data$Race)
  for (i in 1:length(included_races)) {
    race <- race_levels[i]
    count <- nrow(data %>% filter(Race == race))
    gg_subtitle <- paste0(
      gg_subtitle, # previous groups
      # title, count, and percent
      race, ": ", count, " (", floor(100*count/nrow(data)), "%)")
    # add a semi-colon if the list isn't done
    if(i < length(included_races))
      gg_subtitle <- paste0(gg_subtitle, "; ")
    # add a new line after the fourth race group
    if (i == 4)
      gg_subtitle <- paste0(gg_subtitle, "\n")
    }
  
  # plot distribution of time spent incarcerated
  gg_incarated <- data %>%
    filter(!is.na(Months.Incarcerated)) %>%
    ggplot(aes(y = Months.Incarcerated, x = Race)) +
    # jitter points (these must be overlayed by the horizontal line)
    geom_jitter(width = 0.4, color = "aliceblue") +

    # marker at 1 year
    geom_hline(yintercept = 12, color = "red") +
    # time spent wrongfully imprisoned
    geom_violin() +
    geom_boxplot(alpha = 0.5) +
    
    # plot specifics
    ylab("Months imprisoned") + xlab("") +
    scale_y_continuous(breaks = seq(0, 400, 120)) +
    theme_bw() +
    labs(
    title = paste("Time spent incarcerated by exonerees of", crime_filter,
                  "convictions"),
    subtitle = gg_subtitle)
  
  # plot distribution of time spent convicted
  gg_convicted <- data %>%
    filter(!is.na(Months.Convicted)) %>%
    ggplot(aes(y = Months.Convicted, x = Race)) +
    # jitter points (these must be overlayed by the horizontal line)
    geom_jitter(width = 0.4, color = "aliceblue") +

    # marker at 1 year
    geom_hline(yintercept = 12, color = "red") +
    # time spent wrongfully convicted
    geom_violin() +
    geom_boxplot(alpha = 0.5) +
    
    # plot specifics
    ylab("Months convicted") + xlab("") +
    scale_y_continuous(breaks = seq(0, 400, 120)) +
    theme_bw() +
    labs(
    title = paste("Time spent convicted by exonerees of", crime_filter,
                  "convictions"),
    subtitle = gg_subtitle)
  
  
  return(list(incarceration_times = gg_incarated, 
              conviction_times = gg_convicted))
}

# Overall
gridExtra::grid.arrange(
  plot_times(exonerees)$incarceration_times,
  plot_times(exonerees)$conviction_times + labs(subtitle = NULL))

# Murder
plot_times(exonerees, crime_filter = "Murder")$incarceration_times
plot_times(exonerees, crime_filter = "Murder")$conviction_times

# Child sex abuse
plot_times(exonerees, crime_filter = "Child Sex Abuse")$incarceration_times
plot_times(exonerees, crime_filter = "Child Sex Abuse")$conviction_times

# Sexual assault
plot_times(exonerees, crime_filter = "Sexual Assault")$incarceration_times
plot_times(exonerees, crime_filter = "Sexual Assault")$conviction_times

# Robbery
plot_times(exonerees, crime_filter = "Robbery")$incarceration_times
plot_times(exonerees, crime_filter = "Robbery")$conviction_times

# Attempted murder
plot_times(exonerees, crime_filter = "Attempted Murder")$incarceration_times
plot_times(exonerees, crime_filter = "Attempted Murder")$conviction_times

# Drug possession or sale
plot_times(exonerees, crime_filter = "Drug Possession or Sale")$incarceration_times
plot_times(exonerees, crime_filter = "Drug Possession or Sale")$conviction_times

# Assault
plot_times(exonerees, crime_filter = "Assault")$incarceration_times
plot_times(exonerees, crime_filter = "Assault")$conviction_times

# Manslaughter
plot_times(exonerees, crime_filter = "Manslaughter")$incarceration_times
plot_times(exonerees, crime_filter = "Manslaughter")$conviction_times
```


### Distribution of age at events, by offense and race

# Supplementary

#### i. Which offenses account for the most time spent wrongfully incarcerated and convicted for each race? \newline

Table 2 has been recreated to show how the criminal offenses that account for the most time spent wrongfully incarcerated/convicted compare between groups of race.

```{r supp-time-served-table}
### -----------------------------------------------------------
### Supplementary Time Served Table

time_served_table <- function (race_filter) {
  # filter exonerees by race
  data <- exonerees %>% filter(Race == race_filter)
  
  # set headers to columns, for later use
  header_Incarcerated <- paste0("Incarcerated (",
                         formatC(sum(data$Years.Incarcerated), big.mark = ","),
                         " total)")
  header_Convicted <- paste0("Convicted (",
                         formatC(sum(data$Years.Convicted), big.mark = ","),
                        " total)")
  
  # time served incarcerated and convicted (ordered), by offense
  table <- data %>%
    group_by(Offense = Worst.Crime.Display) %>%
    # summarize total years
    summarise(Incarcerated = sum(Years.Incarcerated),
              Convicted = sum(Years.Convicted)) %>%
    # calculate percents
    mutate(Incarcerated.perc = round(100*Incarcerated / sum(Incarcerated)),
           Convicted.perc = round(100*Convicted / sum(Convicted))) %>%
    # arrange
    arrange(desc(Incarcerated)) %>%
    # reformat count to character
    mutate(Incarcerated = formatC(Incarcerated, big.mark = ","),
           Convicted = formatC(Convicted, big.mark = ",")) %>%
    # combine count and percent
    mutate(Incarcerated = paste0(Incarcerated, " (", Incarcerated.perc, "%)"),
           Convicted = paste0(Convicted, " (", Convicted.perc, "%)")) %>%
    # remove unused columns
    select(-contains(".perc")) %>%
    # select top 5
    head(5) %>%
    # pretty print
    kable(
      # rename header to include total time across all offenses
      col.names = c("Offense", header_Incarcerated, header_Convicted),
      caption = paste("Total years spent incarcerated and convicted by",
                      race_filter, "exonerees"))
  return(table)
}

# iterate over all groups of race
time_served_table("Black")
time_served_table("White")
time_served_table("Hispanic")
time_served_table("Asian")
time_served_table("Native American")
time_served_table("Other")
```

\pagebreak

## Code Appendix

```{r allcode, ref.label = knitr::all_labels(), echo=TRUE, eval=FALSE}
```

**Document in progress.**
